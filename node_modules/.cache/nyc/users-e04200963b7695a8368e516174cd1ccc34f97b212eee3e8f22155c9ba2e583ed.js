function cov_vsnrqphid(){var path="/Users/Tomoko1/dbwebb-kurser/jsramverk/me/my-app-backend/models/users.js";var hash="353ad302ae231ab531895c4871429fc4f9183281";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"/Users/Tomoko1/dbwebb-kurser/jsramverk/me/my-app-backend/models/users.js",statementMap:{"0":{start:{line:1,column:17},end:{line:1,column:45}},"1":{start:{line:3,column:17},end:{line:3,column:44}},"2":{start:{line:5,column:18},end:{line:5,column:44}},"3":{start:{line:6,column:15},end:{line:6,column:34}},"4":{start:{line:7,column:19},end:{line:7,column:21}},"5":{start:{line:9,column:12},end:{line:9,column:35}},"6":{start:{line:11,column:14},end:{line:167,column:1}},"7":{start:{line:13,column:22},end:{line:13,column:32}},"8":{start:{line:14,column:25},end:{line:14,column:38}},"9":{start:{line:16,column:8},end:{line:23,column:9}},"10":{start:{line:17,column:12},end:{line:22,column:15}},"11":{start:{line:25,column:8},end:{line:32,column:9}},"12":{start:{line:26,column:12},end:{line:31,column:15}},"13":{start:{line:34,column:8},end:{line:69,column:11}},"14":{start:{line:35,column:12},end:{line:42,column:13}},"15":{start:{line:36,column:16},end:{line:41,column:19}},"16":{start:{line:44,column:21},end:{line:44,column:50}},"17":{start:{line:46,column:12},end:{line:68,column:13}},"18":{start:{line:47,column:29},end:{line:50,column:17}},"19":{start:{line:52,column:16},end:{line:52,column:52}},"20":{start:{line:54,column:16},end:{line:58,column:19}},"21":{start:{line:60,column:16},end:{line:65,column:19}},"22":{start:{line:67,column:16},end:{line:67,column:40}},"23":{start:{line:73,column:22},end:{line:73,column:32}},"24":{start:{line:74,column:25},end:{line:74,column:38}},"25":{start:{line:76,column:8},end:{line:76,column:51}},"26":{start:{line:78,column:8},end:{line:85,column:9}},"27":{start:{line:79,column:12},end:{line:84,column:15}},"28":{start:{line:86,column:17},end:{line:86,column:46}},"29":{start:{line:88,column:8},end:{line:111,column:9}},"30":{start:{line:89,column:26},end:{line:89,column:42}},"31":{start:{line:91,column:25},end:{line:91,column:59}},"32":{start:{line:93,column:12},end:{line:95,column:13}},"33":{start:{line:94,column:16},end:{line:94,column:67}},"34":{start:{line:97,column:12},end:{line:101,column:15}},"35":{start:{line:103,column:12},end:{line:108,column:14}},"36":{start:{line:110,column:12},end:{line:110,column:36}},"37":{start:{line:115,column:8},end:{line:147,column:11}},"38":{start:{line:117,column:12},end:{line:124,column:13}},"39":{start:{line:118,column:16},end:{line:123,column:19}},"40":{start:{line:126,column:12},end:{line:139,column:13}},"41":{start:{line:127,column:32},end:{line:127,column:53}},"42":{start:{line:128,column:31},end:{line:128,column:53}},"43":{start:{line:130,column:30},end:{line:130,column:76}},"44":{start:{line:132,column:16},end:{line:138,column:19}},"45":{start:{line:141,column:12},end:{line:146,column:15}},"46":{start:{line:151,column:22},end:{line:151,column:51}},"47":{start:{line:153,column:8},end:{line:165,column:11}},"48":{start:{line:154,column:12},end:{line:161,column:13}},"49":{start:{line:155,column:16},end:{line:160,column:19}},"50":{start:{line:164,column:12},end:{line:164,column:19}},"51":{start:{line:169,column:0},end:{line:169,column:23}}},fnMap:{"0":{name:"register",decl:{start:{line:12,column:29},end:{line:12,column:37}},loc:{start:{line:12,column:49},end:{line:70,column:5}},line:12},"1":{name:"(anonymous_1)",decl:{start:{line:34,column:42},end:{line:34,column:43}},loc:{start:{line:34,column:69},end:{line:69,column:9}},line:34},"2":{name:"login",decl:{start:{line:72,column:26},end:{line:72,column:31}},loc:{start:{line:72,column:44},end:{line:112,column:5}},line:72},"3":{name:"comparePasswords",decl:{start:{line:114,column:37},end:{line:114,column:53}},loc:{start:{line:114,column:75},end:{line:148,column:5}},line:114},"4":{name:"(anonymous_4)",decl:{start:{line:115,column:48},end:{line:115,column:49}},loc:{start:{line:115,column:71},end:{line:147,column:9}},line:115},"5":{name:"checkToken",decl:{start:{line:150,column:25},end:{line:150,column:35}},loc:{start:{line:150,column:52},end:{line:166,column:5}},line:150},"6":{name:"(anonymous_6)",decl:{start:{line:153,column:50},end:{line:153,column:51}},loc:{start:{line:153,column:74},end:{line:165,column:9}},line:153}},branchMap:{"0":{loc:{start:{line:16,column:8},end:{line:23,column:9}},type:"if",locations:[{start:{line:16,column:8},end:{line:23,column:9}},{start:{line:16,column:8},end:{line:23,column:9}}],line:16},"1":{loc:{start:{line:16,column:12},end:{line:16,column:31}},type:"binary-expr",locations:[{start:{line:16,column:12},end:{line:16,column:18}},{start:{line:16,column:22},end:{line:16,column:31}}],line:16},"2":{loc:{start:{line:25,column:8},end:{line:32,column:9}},type:"if",locations:[{start:{line:25,column:8},end:{line:32,column:9}},{start:{line:25,column:8},end:{line:32,column:9}}],line:25},"3":{loc:{start:{line:35,column:12},end:{line:42,column:13}},type:"if",locations:[{start:{line:35,column:12},end:{line:42,column:13}},{start:{line:35,column:12},end:{line:42,column:13}}],line:35},"4":{loc:{start:{line:78,column:8},end:{line:85,column:9}},type:"if",locations:[{start:{line:78,column:8},end:{line:85,column:9}},{start:{line:78,column:8},end:{line:85,column:9}}],line:78},"5":{loc:{start:{line:78,column:12},end:{line:78,column:31}},type:"binary-expr",locations:[{start:{line:78,column:12},end:{line:78,column:18}},{start:{line:78,column:22},end:{line:78,column:31}}],line:78},"6":{loc:{start:{line:93,column:12},end:{line:95,column:13}},type:"if",locations:[{start:{line:93,column:12},end:{line:95,column:13}},{start:{line:93,column:12},end:{line:95,column:13}}],line:93},"7":{loc:{start:{line:117,column:12},end:{line:124,column:13}},type:"if",locations:[{start:{line:117,column:12},end:{line:124,column:13}},{start:{line:117,column:12},end:{line:124,column:13}}],line:117},"8":{loc:{start:{line:126,column:12},end:{line:139,column:13}},type:"if",locations:[{start:{line:126,column:12},end:{line:139,column:13}},{start:{line:126,column:12},end:{line:139,column:13}}],line:126},"9":{loc:{start:{line:154,column:12},end:{line:161,column:13}},type:"if",locations:[{start:{line:154,column:12},end:{line:161,column:13}},{start:{line:154,column:12},end:{line:161,column:13}}],line:154}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"353ad302ae231ab531895c4871429fc4f9183281"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_vsnrqphid=function(){return actualCoverage;};}return actualCoverage;}cov_vsnrqphid();const database=(cov_vsnrqphid().s[0]++,require('../db/database.js'));const ObjectId=(cov_vsnrqphid().s[1]++,require('mongodb').ObjectId);const validator=(cov_vsnrqphid().s[2]++,require("email-validator"));const bcrypt=(cov_vsnrqphid().s[3]++,require('bcryptjs'));const saltRounds=(cov_vsnrqphid().s[4]++,10);const jwt=(cov_vsnrqphid().s[5]++,require('jsonwebtoken'));const users=(cov_vsnrqphid().s[6]++,{register:async function register(res,body){cov_vsnrqphid().f[0]++;const email=(cov_vsnrqphid().s[7]++,body.email);const password=(cov_vsnrqphid().s[8]++,body.password);cov_vsnrqphid().s[9]++;if((cov_vsnrqphid().b[1][0]++,!email)||(cov_vsnrqphid().b[1][1]++,!password)){cov_vsnrqphid().b[0][0]++;cov_vsnrqphid().s[10]++;return res.status(400).json({errors:{status:400,message:"E-mail or password is missing"}});}else{cov_vsnrqphid().b[0][1]++;}cov_vsnrqphid().s[11]++;if(!validator.validate(email)){cov_vsnrqphid().b[2][0]++;cov_vsnrqphid().s[12]++;return res.status(400).json({errors:{status:400,message:"E-mail is not in correct format"}});}else{cov_vsnrqphid().b[2][1]++;}cov_vsnrqphid().s[13]++;bcrypt.hash(password,saltRounds,async function(err,hash){cov_vsnrqphid().f[1]++;cov_vsnrqphid().s[14]++;if(err){cov_vsnrqphid().b[3][0]++;cov_vsnrqphid().s[15]++;return res.status(500).json({errors:{status:500,message:'Could not hash password'}});}else{cov_vsnrqphid().b[3][1]++;}let db=(cov_vsnrqphid().s[16]++,await database.getDb('users'));cov_vsnrqphid().s[17]++;try{const user=(cov_vsnrqphid().s[18]++,{email:email,password:hash});cov_vsnrqphid().s[19]++;await db.collection.insertOne(user);cov_vsnrqphid().s[20]++;return res.status(201).json({data:{message:'User successfully created.'}});}catch(error){cov_vsnrqphid().s[21]++;return res.status(500).json({errors:{status:500,message:'Could not created new user'}});}finally{cov_vsnrqphid().s[22]++;await db.client.close();}});},login:async function login(res,body){cov_vsnrqphid().f[2]++;const email=(cov_vsnrqphid().s[23]++,body.email);const password=(cov_vsnrqphid().s[24]++,body.password);cov_vsnrqphid().s[25]++;console.log("email&pass",email,password);cov_vsnrqphid().s[26]++;if((cov_vsnrqphid().b[5][0]++,!email)||(cov_vsnrqphid().b[5][1]++,!password)){cov_vsnrqphid().b[4][0]++;cov_vsnrqphid().s[27]++;return res.status(400).json({errors:{status:400,message:"E-mail or password is missing"}});}else{cov_vsnrqphid().b[4][1]++;}let db=(cov_vsnrqphid().s[28]++,await database.getDb("users"));cov_vsnrqphid().s[29]++;try{const query=(cov_vsnrqphid().s[30]++,{email:email});const user=(cov_vsnrqphid().s[31]++,await db.collection.findOne(query));cov_vsnrqphid().s[32]++;if(user){cov_vsnrqphid().b[6][0]++;cov_vsnrqphid().s[33]++;return users.comparePasswords(res,user,password);}else{cov_vsnrqphid().b[6][1]++;}cov_vsnrqphid().s[34]++;return res.status(401).json({data:{message:"User does not exist."}});}catch(error){cov_vsnrqphid().s[35]++;return res.status(500).json({errors:{status:500,message:"Could not find user"}});}finally{cov_vsnrqphid().s[36]++;await db.client.close();}},comparePasswords:async function comparePasswords(res,user,password){cov_vsnrqphid().f[3]++;cov_vsnrqphid().s[37]++;bcrypt.compare(password,user.password,function(err,result){cov_vsnrqphid().f[4]++;cov_vsnrqphid().s[38]++;if(err){cov_vsnrqphid().b[7][0]++;cov_vsnrqphid().s[39]++;return res.status(500).json({errors:{status:500,message:"Could not decrypt password."}});}else{cov_vsnrqphid().b[7][1]++;}cov_vsnrqphid().s[40]++;if(result){cov_vsnrqphid().b[8][0]++;const payload=(cov_vsnrqphid().s[41]++,{email:user.email});const secret=(cov_vsnrqphid().s[42]++,process.env.JWT_SECRET);const token=(cov_vsnrqphid().s[43]++,jwt.sign(payload,secret,{expiresIn:'1h'}));cov_vsnrqphid().s[44]++;return res.status(201).json({data:{_id:user["_id"],email:user.email,token:token}});}else{cov_vsnrqphid().b[8][1]++;}cov_vsnrqphid().s[45]++;return res.status(401).json({errors:{status:401,message:"Password not correct"}});});},checkToken:function checkToken(req,res,next){cov_vsnrqphid().f[5]++;const token=(cov_vsnrqphid().s[46]++,req.headers['x-access-token']);cov_vsnrqphid().s[47]++;jwt.verify(token,process.env.JWT_SECRET,function(err,decoded){cov_vsnrqphid().f[6]++;cov_vsnrqphid().s[48]++;if(err){cov_vsnrqphid().b[9][0]++;cov_vsnrqphid().s[49]++;return res.status(401).json({errors:{status:401,message:"Token is not valid."}});}else{cov_vsnrqphid().b[9][1]++;}// Valid token send on the request
cov_vsnrqphid().s[50]++;next();});}});cov_vsnrqphid().s[51]++;module.exports=users;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkYXRhYmFzZSIsInJlcXVpcmUiLCJPYmplY3RJZCIsInZhbGlkYXRvciIsImJjcnlwdCIsInNhbHRSb3VuZHMiLCJqd3QiLCJ1c2VycyIsInJlZ2lzdGVyIiwicmVzIiwiYm9keSIsImVtYWlsIiwicGFzc3dvcmQiLCJzdGF0dXMiLCJqc29uIiwiZXJyb3JzIiwibWVzc2FnZSIsInZhbGlkYXRlIiwiaGFzaCIsImVyciIsImRiIiwiZ2V0RGIiLCJ1c2VyIiwiY29sbGVjdGlvbiIsImluc2VydE9uZSIsImRhdGEiLCJlcnJvciIsImNsaWVudCIsImNsb3NlIiwibG9naW4iLCJjb25zb2xlIiwibG9nIiwicXVlcnkiLCJmaW5kT25lIiwiY29tcGFyZVBhc3N3b3JkcyIsImNvbXBhcmUiLCJyZXN1bHQiLCJwYXlsb2FkIiwic2VjcmV0IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ0b2tlbiIsInNpZ24iLCJleHBpcmVzSW4iLCJfaWQiLCJjaGVja1Rva2VuIiwicmVxIiwibmV4dCIsImhlYWRlcnMiLCJ2ZXJpZnkiLCJkZWNvZGVkIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInVzZXJzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRhdGFiYXNlID0gcmVxdWlyZSgnLi4vZGIvZGF0YWJhc2UuanMnKTtcblxuY29uc3QgT2JqZWN0SWQgPSByZXF1aXJlKCdtb25nb2RiJykuT2JqZWN0SWQ7XG5cbmNvbnN0IHZhbGlkYXRvciA9IHJlcXVpcmUoXCJlbWFpbC12YWxpZGF0b3JcIik7XG5jb25zdCBiY3J5cHQgPSByZXF1aXJlKCdiY3J5cHRqcycpOyBcbmNvbnN0IHNhbHRSb3VuZHMgPSAxMDtcblxuY29uc3Qgand0ID0gcmVxdWlyZSgnanNvbndlYnRva2VuJyk7XG5cbmNvbnN0IHVzZXJzID0ge1xuICAgIHJlZ2lzdGVyOiBhc3luYyBmdW5jdGlvbiByZWdpc3RlcihyZXMsIGJvZHkpIHtcbiAgICAgICAgY29uc3QgZW1haWwgPSBib2R5LmVtYWlsO1xuICAgICAgICBjb25zdCBwYXNzd29yZCA9IGJvZHkucGFzc3dvcmQ7ICBcblxuICAgICAgICBpZiAoIWVtYWlsIHx8ICFwYXNzd29yZCkge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcbiAgICAgICAgICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDAsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiRS1tYWlsIG9yIHBhc3N3b3JkIGlzIG1pc3NpbmdcIixcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTsgIFxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKCF2YWxpZGF0b3IudmFsaWRhdGUoZW1haWwpKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgICAgIGVycm9yczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMCxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJFLW1haWwgaXMgbm90IGluIGNvcnJlY3QgZm9ybWF0XCIsXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBiY3J5cHQuaGFzaChwYXNzd29yZCwgc2FsdFJvdW5kcywgYXN5bmMgZnVuY3Rpb24gKGVyciwgaGFzaCkge1xuICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDUwMCkuanNvbih7XG4gICAgICAgICAgICAgICAgICAgIGVycm9yczoge1xuICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlOiAnQ291bGQgbm90IGhhc2ggcGFzc3dvcmQnLFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7IFxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBsZXQgZGIgPSBhd2FpdCBkYXRhYmFzZS5nZXREYigndXNlcnMnKTtcblxuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBjb25zdCB1c2VyID0ge1xuICAgICAgICAgICAgICAgICAgICBlbWFpbDogZW1haWwsXG4gICAgICAgICAgICAgICAgICAgIHBhc3N3b3JkOiBoYXNoLFxuICAgICAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgICAgICBhd2FpdCBkYi5jb2xsZWN0aW9uLmluc2VydE9uZSh1c2VyKTtcblxuICAgICAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDIwMSkuanNvbih7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6ICdVc2VyIHN1Y2Nlc3NmdWxseSBjcmVhdGVkLidcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg1MDApLmpzb24oe1xuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogNTAwLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogJ0NvdWxkIG5vdCBjcmVhdGVkIG5ldyB1c2VyJyxcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgICAgICAgICBhd2FpdCBkYi5jbGllbnQuY2xvc2UoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSxcblxuICAgIGxvZ2luOiBhc3luYyBmdW5jdGlvbiBsb2dpbiAocmVzLCBib2R5KSB7XG4gICAgICAgIGNvbnN0IGVtYWlsID0gYm9keS5lbWFpbDtcbiAgICAgICAgY29uc3QgcGFzc3dvcmQgPSBib2R5LnBhc3N3b3JkO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKFwiZW1haWwmcGFzc1wiLCBlbWFpbCwgcGFzc3dvcmQpO1xuXG4gICAgICAgIGlmICghZW1haWwgfHwgIXBhc3N3b3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oe1xuICAgICAgICAgICAgICAgIGVycm9yczoge1xuICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDQwMCxcbiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJFLW1haWwgb3IgcGFzc3dvcmQgaXMgbWlzc2luZ1wiLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pOyAgXG4gICAgICAgIH1cbiAgICAgICAgbGV0IGRiID0gYXdhaXQgZGF0YWJhc2UuZ2V0RGIoXCJ1c2Vyc1wiKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QgcXVlcnkgPSB7IGVtYWlsOiBlbWFpbCB9O1xuXG4gICAgICAgICAgICBjb25zdCB1c2VyID0gYXdhaXQgZGIuY29sbGVjdGlvbi5maW5kT25lKHF1ZXJ5KTtcblxuICAgICAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gdXNlcnMuY29tcGFyZVBhc3N3b3JkcyhyZXMsIHVzZXIsIHBhc3N3b3JkKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiVXNlciBkb2VzIG5vdCBleGlzdC5cIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA1MDAsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiQ291bGQgbm90IGZpbmQgdXNlclwiLFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pXG4gICAgICAgIH0gZmluYWxseSB7XG4gICAgICAgICAgICBhd2FpdCBkYi5jbGllbnQuY2xvc2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG5cbiAgICBjb21wYXJlUGFzc3dvcmRzOiBhc3luYyBmdW5jdGlvbiBjb21wYXJlUGFzc3dvcmRzKHJlcywgdXNlciwgcGFzc3dvcmQpIHtcbiAgICAgICAgYmNyeXB0LmNvbXBhcmUocGFzc3dvcmQsIHVzZXIucGFzc3dvcmQsIGZ1bmN0aW9uIChlcnIsIHJlc3VsdCkge1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcbiAgICAgICAgICAgICAgICAgICAgZXJyb3JzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXM6IDUwMCxcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiQ291bGQgbm90IGRlY3J5cHQgcGFzc3dvcmQuXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAocmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGF5bG9hZCA9IHsgZW1haWw6IHVzZXIuZW1haWwgfTtcbiAgICAgICAgICAgICAgICBjb25zdCBzZWNyZXQgPSBwcm9jZXNzLmVudi5KV1RfU0VDUkVUO1xuXG4gICAgICAgICAgICAgICAgY29uc3QgdG9rZW4gPSBqd3Quc2lnbihwYXlsb2FkLCBzZWNyZXQsIHsgZXhwaXJlc0luOiAnMWgnIH0pO1xuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoMjAxKS5qc29uKHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2lkOiB1c2VyW1wiX2lkXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgICAgICAgICAgICAgICAgICB0b2tlbjogdG9rZW4sXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5qc29uKHtcbiAgICAgICAgICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzOiA0MDEsXG4gICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IFwiUGFzc3dvcmQgbm90IGNvcnJlY3RcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9LFxuXG4gICAgY2hlY2tUb2tlbjogZnVuY3Rpb24gY2hlY2tUb2tlbihyZXEsIHJlcywgbmV4dCkge1xuICAgICAgICBjb25zdCB0b2tlbiA9IHJlcS5oZWFkZXJzWyd4LWFjY2Vzcy10b2tlbiddO1xuXG4gICAgICAgIGp3dC52ZXJpZnkodG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQsIGZ1bmN0aW9uIChlcnIsIGRlY29kZWQpIHtcbiAgICAgICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLmpzb24oe1xuICAgICAgICAgICAgICAgICAgICBlcnJvcnM6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1czogNDAxLFxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZTogXCJUb2tlbiBpcyBub3QgdmFsaWQuXCJcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBWYWxpZCB0b2tlbiBzZW5kIG9uIHRoZSByZXF1ZXN0XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0pO1xuICAgIH1cbn07XG5cbm1vZHVsZS5leHBvcnRzID0gdXNlcnM7XG4iXSwibWFwcGluZ3MiOiJ3OE5BZVk7QUFBQSx5RkFmWixLQUFNQSxTQUFRLHlCQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFFN0MsS0FBTUMsU0FBUSx5QkFBR0QsT0FBTyxDQUFDLFNBQVMsQ0FBQyxDQUFDQyxRQUFRLEVBRTVDLEtBQU1DLFVBQVMseUJBQUdGLE9BQU8sQ0FBQyxpQkFBaUIsQ0FBQyxFQUM1QyxLQUFNRyxPQUFNLHlCQUFHSCxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQ2xDLEtBQU1JLFdBQVUseUJBQUcsRUFBRSxFQUVyQixLQUFNQyxJQUFHLHlCQUFHTCxPQUFPLENBQUMsY0FBYyxDQUFDLEVBRW5DLEtBQU1NLE1BQUsseUJBQUcsQ0FDVkMsUUFBUSxDQUFFLGNBQWVBLFNBQVEsQ0FBQ0MsR0FBRyxDQUFFQyxJQUFJLENBQUUsd0JBQ3pDLEtBQU1DLE1BQUsseUJBQUdELElBQUksQ0FBQ0MsS0FBSyxFQUN4QixLQUFNQyxTQUFRLHlCQUFHRixJQUFJLENBQUNFLFFBQVEsRUFBQyx1QkFFL0IsR0FBSSw0QkFBQ0QsS0FBSyw4QkFBSSxDQUFDQyxRQUFRLEVBQUUsbURBQ3JCLE1BQU9ILElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDeEJDLE1BQU0sQ0FBRSxDQUNKRixNQUFNLENBQUUsR0FBRyxDQUNYRyxPQUFPLENBQUUsK0JBQ2IsQ0FDSixDQUFDLENBQUMsQ0FDTixDQUFDLHdEQUVELEdBQUksQ0FBQ2IsU0FBUyxDQUFDYyxRQUFRLENBQUNOLEtBQUssQ0FBQyxDQUFFLG1EQUM1QixNQUFPRixJQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQ3hCQyxNQUFNLENBQUUsQ0FDSkYsTUFBTSxDQUFFLEdBQUcsQ0FDWEcsT0FBTyxDQUFFLGlDQUNiLENBQ0osQ0FBQyxDQUFDLENBQ04sQ0FBQyx3REFFRFosTUFBTSxDQUFDYyxJQUFJLENBQUNOLFFBQVEsQ0FBRVAsVUFBVSxDQUFFLGVBQWdCYyxHQUFHLENBQUVELElBQUksQ0FBRSxnREFDekQsR0FBSUMsR0FBRyxDQUFFLG1EQUNMLE1BQU9WLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDeEJDLE1BQU0sQ0FBRSxDQUNKRixNQUFNLENBQUUsR0FBRyxDQUNYRyxPQUFPLENBQUUseUJBQ2IsQ0FDSixDQUFDLENBQUMsQ0FDTixDQUFDLGdDQUVELEdBQUlJLEdBQUUsMEJBQUcsS0FBTXBCLFNBQVEsQ0FBQ3FCLEtBQUssQ0FBQyxPQUFPLENBQUMsRUFBQyx3QkFFdkMsR0FBSSxDQUNBLEtBQU1DLEtBQUksMEJBQUcsQ0FDVFgsS0FBSyxDQUFFQSxLQUFLLENBQ1pDLFFBQVEsQ0FBRU0sSUFDZCxDQUFDLEVBQUMsd0JBRUYsS0FBTUUsR0FBRSxDQUFDRyxVQUFVLENBQUNDLFNBQVMsQ0FBQ0YsSUFBSSxDQUFDLENBQUMsd0JBRXBDLE1BQU9iLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDeEJXLElBQUksQ0FBRSxDQUNGVCxPQUFPLENBQUUsNEJBQ2IsQ0FDSixDQUFDLENBQUMsQ0FDTixDQUFFLE1BQU9VLEtBQUssQ0FBRSx5QkFDWixNQUFPakIsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUN4QkMsTUFBTSxDQUFFLENBQ0pGLE1BQU0sQ0FBRSxHQUFHLENBQ1hHLE9BQU8sQ0FBRSw0QkFDYixDQUNKLENBQUMsQ0FBQyxDQUNOLENBQUMsT0FBUyx5QkFDTixLQUFNSSxHQUFFLENBQUNPLE1BQU0sQ0FBQ0MsS0FBSyxFQUFFLENBQzNCLENBQ0osQ0FBQyxDQUFDLENBQ04sQ0FBQyxDQUVEQyxLQUFLLENBQUUsY0FBZUEsTUFBSyxDQUFFcEIsR0FBRyxDQUFFQyxJQUFJLENBQUUsd0JBQ3BDLEtBQU1DLE1BQUssMEJBQUdELElBQUksQ0FBQ0MsS0FBSyxFQUN4QixLQUFNQyxTQUFRLDBCQUFHRixJQUFJLENBQUNFLFFBQVEsRUFBQyx3QkFFL0JrQixPQUFPLENBQUNDLEdBQUcsQ0FBQyxZQUFZLENBQUVwQixLQUFLLENBQUVDLFFBQVEsQ0FBQyxDQUFDLHdCQUUzQyxHQUFJLDRCQUFDRCxLQUFLLDhCQUFJLENBQUNDLFFBQVEsRUFBRSxtREFDckIsTUFBT0gsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUN4QkMsTUFBTSxDQUFFLENBQ0pGLE1BQU0sQ0FBRSxHQUFHLENBQ1hHLE9BQU8sQ0FBRSwrQkFDYixDQUNKLENBQUMsQ0FBQyxDQUNOLENBQUMsZ0NBQ0QsR0FBSUksR0FBRSwwQkFBRyxLQUFNcEIsU0FBUSxDQUFDcUIsS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFDLHdCQUV2QyxHQUFJLENBQ0EsS0FBTVcsTUFBSywwQkFBRyxDQUFFckIsS0FBSyxDQUFFQSxLQUFNLENBQUMsRUFFOUIsS0FBTVcsS0FBSSwwQkFBRyxLQUFNRixHQUFFLENBQUNHLFVBQVUsQ0FBQ1UsT0FBTyxDQUFDRCxLQUFLLENBQUMsRUFBQyx3QkFFaEQsR0FBSVYsSUFBSSxDQUFFLG1EQUNOLE1BQU9mLE1BQUssQ0FBQzJCLGdCQUFnQixDQUFDekIsR0FBRyxDQUFFYSxJQUFJLENBQUVWLFFBQVEsQ0FBQyxDQUN0RCxDQUFDLHdEQUVELE1BQU9ILElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDeEJXLElBQUksQ0FBRSxDQUNGVCxPQUFPLENBQUUsc0JBQ2IsQ0FDSixDQUFDLENBQUMsQ0FDTixDQUFFLE1BQU9VLEtBQUssQ0FBRSx5QkFDWixNQUFPakIsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUN4QkMsTUFBTSxDQUFFLENBQ0pGLE1BQU0sQ0FBRSxHQUFHLENBQ1hHLE9BQU8sQ0FBRSxxQkFDYixDQUNKLENBQUMsQ0FBQyxDQUNOLENBQUMsT0FBUyx5QkFDTixLQUFNSSxHQUFFLENBQUNPLE1BQU0sQ0FBQ0MsS0FBSyxFQUFFLENBQzNCLENBQ0osQ0FBQyxDQUVETSxnQkFBZ0IsQ0FBRSxjQUFlQSxpQkFBZ0IsQ0FBQ3pCLEdBQUcsQ0FBRWEsSUFBSSxDQUFFVixRQUFRLENBQUUsZ0RBQ25FUixNQUFNLENBQUMrQixPQUFPLENBQUN2QixRQUFRLENBQUVVLElBQUksQ0FBQ1YsUUFBUSxDQUFFLFNBQVVPLEdBQUcsQ0FBRWlCLE1BQU0sQ0FBRSxnREFFM0QsR0FBSWpCLEdBQUcsQ0FBRSxtREFDTCxNQUFPVixJQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQ3hCQyxNQUFNLENBQUUsQ0FDSkYsTUFBTSxDQUFFLEdBQUcsQ0FDWEcsT0FBTyxDQUFFLDZCQUNiLENBQ0osQ0FBQyxDQUFDLENBQ04sQ0FBQyx3REFFRCxHQUFJb0IsTUFBTSxDQUFFLDJCQUNSLEtBQU1DLFFBQU8sMEJBQUcsQ0FBRTFCLEtBQUssQ0FBRVcsSUFBSSxDQUFDWCxLQUFNLENBQUMsRUFDckMsS0FBTTJCLE9BQU0sMEJBQUdDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLEVBRXJDLEtBQU1DLE1BQUssMEJBQUdwQyxHQUFHLENBQUNxQyxJQUFJLENBQUNOLE9BQU8sQ0FBRUMsTUFBTSxDQUFFLENBQUVNLFNBQVMsQ0FBRSxJQUFLLENBQUMsQ0FBQyxFQUFDLHdCQUU3RCxNQUFPbkMsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxDQUN4QlcsSUFBSSxDQUFFLENBQ0ZvQixHQUFHLENBQUV2QixJQUFJLENBQUMsS0FBSyxDQUFDLENBQ2hCWCxLQUFLLENBQUVXLElBQUksQ0FBQ1gsS0FBSyxDQUNqQitCLEtBQUssQ0FBRUEsS0FDWCxDQUNKLENBQUMsQ0FBQyxDQUNOLENBQUMsd0RBRUQsTUFBT2pDLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsQ0FDeEJDLE1BQU0sQ0FBRSxDQUNKRixNQUFNLENBQUUsR0FBRyxDQUNYRyxPQUFPLENBQUUsc0JBQ2IsQ0FDSixDQUFDLENBQUMsQ0FDTixDQUFDLENBQUMsQ0FDTixDQUFDLENBRUQ4QixVQUFVLENBQUUsUUFBU0EsV0FBVSxDQUFDQyxHQUFHLENBQUV0QyxHQUFHLENBQUV1QyxJQUFJLENBQUUsd0JBQzVDLEtBQU1OLE1BQUssMEJBQUdLLEdBQUcsQ0FBQ0UsT0FBTyxDQUFDLGdCQUFnQixDQUFDLEVBQUMsd0JBRTVDM0MsR0FBRyxDQUFDNEMsTUFBTSxDQUFDUixLQUFLLENBQUVILE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUUsU0FBVXRCLEdBQUcsQ0FBRWdDLE9BQU8sQ0FBRSxnREFDOUQsR0FBSWhDLEdBQUcsQ0FBRSxtREFDTCxNQUFPVixJQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLENBQ3hCQyxNQUFNLENBQUUsQ0FDSkYsTUFBTSxDQUFFLEdBQUcsQ0FDWEcsT0FBTyxDQUFFLHFCQUNiLENBQ0osQ0FBQyxDQUFDLENBQ04sQ0FBQyxnQ0FFRDtBQUFBLHdCQUNBZ0MsSUFBSSxFQUFFLENBQ1YsQ0FBQyxDQUFDLENBQ04sQ0FDSixDQUFDLEVBQUMsd0JBRUZJLE1BQU0sQ0FBQ0MsT0FBTyxDQUFHOUMsS0FBSyJ9